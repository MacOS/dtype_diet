---

title: Project name here


keywords: fastai
sidebar: home_sidebar

summary: "Summary description here."
description: "Summary description here."
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This file will become your README and also the index of your documentation.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install dtype_diet</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Fill me in please! Don't forget code examples:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Status</span> <span class="o">-</span> <span class="n">early</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">written</span> <span class="ow">in</span> <span class="mi">2</span> <span class="n">hours</span> <span class="n">on</span> <span class="n">a</span> <span class="n">Sunday</span><span class="o">.</span> <span class="n">Suggestions</span> <span class="n">welcome</span><span class="p">,</span> <span class="n">I</span> <span class="n">may</span> <span class="n">accept</span> <span class="n">PRs</span> <span class="n">but</span> <span class="n">you</span><span class="s1">&#39;re better off asking first (via a bug report) with the suggestion in case it isn&#39;</span><span class="n">t</span> <span class="n">where</span> <span class="n">I</span> <span class="n">want</span> <span class="n">to</span> <span class="n">take</span> <span class="n">the</span> <span class="n">library</span><span class="o">.</span> <span class="n">I</span><span class="s1">&#39;m also very happy to have &quot;Thanks&quot; posted via bugs too if this helps you out :-)</span>

<span class="n">This</span> <span class="n">tool</span> <span class="n">checks</span> <span class="n">each</span> <span class="n">column</span> <span class="n">to</span> <span class="n">see</span> <span class="k">if</span> <span class="n">larger</span> <span class="n">dtypes</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="mi">8</span> <span class="n">byte</span> <span class="err">`</span><span class="n">float64</span><span class="err">`</span> <span class="ow">and</span> <span class="err">`</span><span class="n">int64</span><span class="err">`</span><span class="p">)</span> <span class="n">could</span> <span class="n">be</span> <span class="n">shrunk</span> <span class="n">to</span> <span class="n">smaller</span> <span class="err">`</span><span class="n">dtypes</span><span class="err">`</span> <span class="n">without</span> <span class="n">causing</span> <span class="nb">any</span> <span class="n">data</span> <span class="n">loss</span><span class="o">.</span> 
<span class="n">Dropping</span> <span class="n">an</span> <span class="mi">8</span> <span class="n">byte</span> <span class="nb">type</span> <span class="n">to</span> <span class="n">a</span> <span class="mi">4</span> <span class="p">(</span><span class="ow">or</span> <span class="mi">2</span> <span class="ow">or</span> <span class="mi">1</span> <span class="n">byte</span><span class="p">)</span> <span class="nb">type</span> <span class="n">will</span> <span class="n">keep</span> <span class="n">halving</span> <span class="n">the</span> <span class="n">RAM</span> <span class="n">requirement</span> <span class="k">for</span> <span class="n">that</span> <span class="n">column</span><span class="o">.</span>  <span class="n">Categoricals</span> <span class="n">are</span> <span class="n">proposed</span> <span class="k">for</span> <span class="err">`</span><span class="nb">object</span><span class="err">`</span> <span class="n">columns</span> <span class="n">which</span> <span class="n">can</span> <span class="n">bring</span> <span class="n">significant</span> <span class="n">speed</span> <span class="ow">and</span> <span class="n">RAM</span> <span class="n">benefits</span><span class="o">.</span>

<span class="n">Whilst</span> <span class="n">working</span> <span class="n">on</span> <span class="n">the</span> <span class="p">[</span><span class="mi">2</span><span class="n">nd</span> <span class="n">edition</span> <span class="n">of</span> <span class="n">High</span> <span class="n">Performance</span> <span class="n">Python</span><span class="p">](</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">goodreads</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">book</span><span class="o">/</span><span class="n">show</span><span class="o">/</span><span class="mi">49828191</span><span class="o">-</span><span class="n">high</span><span class="o">-</span><span class="n">performance</span><span class="o">-</span><span class="n">python</span><span class="p">)</span> <span class="k">with</span> <span class="n">Micha</span> <span class="n">Gorelick</span> <span class="n">I</span> <span class="n">wrote</span> <span class="n">on</span> <span class="n">RAM</span> <span class="n">reduction</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">Using</span> <span class="n">Less</span> <span class="n">RAM</span> <span class="n">chapter</span> <span class="k">for</span> <span class="n">Pandas</span> <span class="ow">and</span> <span class="n">NumPy</span> <span class="ow">and</span> <span class="n">I</span> <span class="n">wanted</span> <span class="n">to</span> <span class="n">write</span> <span class="n">a</span> <span class="n">tool</span> <span class="n">like</span> <span class="n">this</span><span class="p">,</span> <span class="n">but</span> <span class="n">didn</span><span class="s1">&#39;t have time (heck, writing the 2nd edition took 9 months!). So, I got to write this tool after publication instead.</span>

<span class="n">Here</span><span class="s1">&#39;s an example (see Notebook: [example_sell_prices_ram_shrinkage.ipynb](example_sell_prices_ram_shrinkage.ipynb) ) on a Kaggle dataset showing a reduction of 957 -&gt; 85MB:</span>

<span class="o">![</span>sell_prices after dtype_dtype<span class="o">](</span>example_sell_prices.png<span class="o">)</span>

<span class="n">Recommendations</span><span class="p">:</span>

<span class="o">*</span> <span class="n">Run</span> <span class="err">`</span><span class="n">report_on_dataframe</span><span class="p">(</span><span class="n">your_df</span><span class="p">)</span><span class="err">`</span> <span class="n">to</span> <span class="n">get</span> <span class="n">recommendations</span>
<span class="o">*</span> <span class="n">Consider</span> <span class="k">if</span> <span class="n">Categoricals</span> <span class="n">will</span> <span class="n">save</span> <span class="n">you</span> <span class="n">RAM</span> <span class="p">(</span><span class="n">see</span> <span class="n">Caveats</span> <span class="n">below</span><span class="p">)</span>
<span class="o">*</span> <span class="n">Consider</span> <span class="k">if</span> <span class="n">f32</span> <span class="ow">or</span> <span class="n">f16</span> <span class="n">will</span> <span class="n">be</span> <span class="n">useful</span> <span class="p">(</span><span class="n">see</span> <span class="n">Caveats</span> <span class="o">-</span> <span class="n">f32</span> <span class="ow">is</span> <span class="n">_probably_</span> <span class="n">a</span> <span class="n">reasonable</span> <span class="n">choice</span> <span class="n">unless</span> <span class="n">you</span> <span class="n">have</span> <span class="n">huge</span> <span class="n">ranges</span> <span class="n">of</span> <span class="n">floats</span><span class="p">)</span>
<span class="o">*</span> <span class="n">Consider</span> <span class="k">if</span> <span class="n">int32</span><span class="p">,</span> <span class="n">int16</span><span class="p">,</span> <span class="n">int8</span> <span class="n">will</span> <span class="n">be</span> <span class="n">useful</span> <span class="p">(</span><span class="n">see</span> <span class="n">Caveats</span> <span class="o">-</span> <span class="n">overflow</span> <span class="n">may</span> <span class="n">be</span> <span class="n">an</span> <span class="n">issue</span><span class="p">)</span>
<span class="o">*</span> <span class="n">Look</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pandas</span><span class="o">.</span><span class="n">pydata</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">pandas</span><span class="o">-</span><span class="n">docs</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">convert_dtypes</span><span class="o">.</span><span class="n">html</span> <span class="n">which</span> <span class="n">recommends</span> <span class="n">Pandas</span> <span class="n">nullable</span> <span class="n">dtype</span> <span class="n">alternatives</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">promoting</span> <span class="n">an</span> <span class="n">int64</span> <span class="k">with</span> <span class="n">NaN</span> <span class="n">items</span> <span class="n">to</span> <span class="n">float64</span><span class="p">,</span> <span class="n">instead</span> <span class="n">you</span> <span class="n">get</span> <span class="n">Int64</span> <span class="k">with</span> <span class="n">NaNs</span> <span class="ow">and</span> <span class="n">no</span> <span class="n">data</span> <span class="n">loss</span><span class="p">)</span>
<span class="o">*</span> <span class="n">Look</span> <span class="n">at</span> <span class="n">Extension</span> <span class="n">arrays</span> <span class="n">like</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">JDASoftwareGroup</span><span class="o">/</span><span class="n">rle</span><span class="o">-</span><span class="n">array</span> <span class="p">(</span><span class="n">thanks</span> <span class="nd">@repererum</span> <span class="p">[</span><span class="k">for</span> <span class="n">the</span> <span class="n">tweet</span><span class="p">](</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">twitter</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">crepererum</span><span class="o">/</span><span class="n">status</span><span class="o">/</span><span class="mi">1267441357339201536</span><span class="p">))</span>

<span class="n">Look</span> <span class="n">at</span> <span class="err">`</span><span class="n">__main__</span><span class="err">`</span> <span class="ow">and</span> <span class="k">try</span> <span class="err">`</span><span class="n">report_on_dataframe</span><span class="p">(</span><span class="n">your_df</span><span class="p">)</span><span class="err">`</span> <span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="n">printed</span> <span class="n">report</span> <span class="o">-</span> <span class="n">no</span> <span class="n">changes</span> <span class="n">are</span> <span class="n">made</span> <span class="n">to</span> <span class="n">your</span> <span class="n">dataframe</span><span class="o">.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">### CLI</span>

<span class="err">```</span><span class="n">bash</span>
<span class="err">$</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">dtype_diet</span><span class="o">.</span><span class="n">py</span>
<span class="err">$</span> <span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ianozsvald</span><span class="o">/</span><span class="n">dtype_diet</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">dtype_diet</span><span class="o">.</span><span class="n">py</span>
<span class="err">```</span>

<span class="c1">### Notebook</span>

<span class="err">```</span><span class="n">bash</span>
<span class="o">%%</span><span class="k">bash</span>
rm -f dtype_diet.py
wget https://raw.githubusercontent.com/ianozsvald/dtype_diet/master/dtype_diet.py
```
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="err">```</span><span class="n">python</span>
<span class="kn">import</span> <span class="nn">dtype_diet</span>
<span class="o">...</span><span class="p">(</span><span class="k">for</span> <span class="n">rest</span> <span class="n">of</span> <span class="n">the</span> <span class="n">usage</span> <span class="n">example</span> <span class="n">see</span> <span class="n">notebook</span> <span class="n">mention</span> <span class="ow">in</span> <span class="n">previous</span> <span class="n">section</span><span class="p">)</span><span class="o">...</span>
<span class="err">```</span>

<span class="c1"># example run on a made-up dataframe in __main__</span>

<span class="err">```</span>
<span class="n">dtype_diet</span><span class="err">$</span> <span class="n">python</span> <span class="n">dtype_diet</span><span class="o">.</span><span class="n">py</span> 
<span class="n">Given</span> <span class="n">a</span> <span class="n">dataframe</span><span class="p">,</span> <span class="n">check</span> <span class="k">for</span> <span class="n">lowest</span> <span class="n">possible</span> <span class="n">conversions</span><span class="p">:</span>
<span class="n">Smallest</span> <span class="n">non</span><span class="o">-</span><span class="n">breaking</span> <span class="n">converstion</span> <span class="n">per</span> <span class="n">column</span><span class="p">:</span>
<span class="n">a</span> <span class="p">(</span><span class="n">int64</span><span class="p">)</span> <span class="n">currently</span> <span class="n">taking</span> <span class="mi">928</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">to</span> <span class="n">save</span> <span class="mi">700</span> <span class="nb">bytes</span> <span class="k">try</span> <span class="err">`</span><span class="n">a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">int8</span><span class="p">)</span><span class="err">`</span>
<span class="n">b</span> <span class="p">(</span><span class="n">int64</span><span class="p">)</span> <span class="n">currently</span> <span class="n">taking</span> <span class="mi">928</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">to</span> <span class="n">save</span> <span class="mi">600</span> <span class="nb">bytes</span> <span class="k">try</span> <span class="err">`</span><span class="n">b</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">int16</span><span class="p">)</span><span class="err">`</span>
<span class="n">c</span> <span class="p">(</span><span class="n">int64</span><span class="p">)</span> <span class="n">currently</span> <span class="n">taking</span> <span class="mi">928</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">to</span> <span class="n">save</span> <span class="mi">400</span> <span class="nb">bytes</span> <span class="k">try</span> <span class="err">`</span><span class="n">c</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">int32</span><span class="p">)</span><span class="err">`</span>
<span class="n">d</span> <span class="p">(</span><span class="n">float64</span><span class="p">)</span> <span class="n">currently</span> <span class="n">taking</span> <span class="mi">928</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">to</span> <span class="n">save</span> <span class="mi">600</span> <span class="nb">bytes</span> <span class="k">try</span> <span class="err">`</span><span class="n">d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">float16</span><span class="p">)</span><span class="err">`</span>
<span class="n">e</span> <span class="p">(</span><span class="n">float64</span><span class="p">)</span> <span class="n">currently</span> <span class="n">taking</span> <span class="mi">928</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">to</span> <span class="n">save</span> <span class="mi">400</span> <span class="nb">bytes</span> <span class="k">try</span> <span class="err">`</span><span class="n">e</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">float32</span><span class="p">)</span><span class="err">`</span>
<span class="n">str_a</span> <span class="p">(</span><span class="nb">object</span><span class="p">)</span> <span class="n">currently</span> <span class="n">taking</span> <span class="mi">6</span><span class="p">,</span><span class="mi">328</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">to</span> <span class="n">save</span> <span class="mi">5</span><span class="p">,</span><span class="mi">958</span> <span class="nb">bytes</span> <span class="k">try</span> <span class="err">`</span><span class="n">str_a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">category</span><span class="p">)</span><span class="err">`</span>
<span class="n">str_b</span> <span class="p">(</span><span class="nb">object</span><span class="p">)</span> <span class="n">currently</span> <span class="n">taking</span> <span class="mi">6</span><span class="p">,</span><span class="mi">018</span> <span class="nb">bytes</span> <span class="o">-</span> <span class="n">no</span> <span class="n">suggestion</span>
<span class="err">```</span>

<span class="c1">## Caveats</span>

<span class="o">*</span> <span class="n">reduced</span> <span class="n">numeric</span> <span class="n">ranges</span> <span class="n">might</span> <span class="n">lead</span> <span class="n">to</span> <span class="n">overflow</span> <span class="p">(</span><span class="n">TODO</span> <span class="n">document</span><span class="p">)</span>
<span class="o">*</span> <span class="n">category</span> <span class="n">dtype</span> <span class="n">can</span> <span class="n">have</span> <span class="n">unexpected</span> <span class="n">effects</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">need</span> <span class="k">for</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span> <span class="ow">in</span> <span class="n">groupby</span> <span class="p">(</span><span class="n">TODO</span> <span class="n">document</span><span class="p">)</span>
<span class="o">*</span> <span class="n">f16</span> <span class="ow">is</span> <span class="n">likely</span> <span class="n">to</span> <span class="n">be</span> <span class="n">simulated</span> <span class="n">on</span> <span class="n">modern</span> <span class="n">hardware</span> <span class="n">so</span> <span class="n">calculations</span> <span class="n">will</span> <span class="n">be</span> <span class="mi">2</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span> <span class="n">slower</span> <span class="n">than</span> <span class="n">on</span> <span class="n">f32</span> <span class="ow">or</span> <span class="n">f64</span>
<span class="o">*</span> <span class="n">we</span> <span class="n">could</span> <span class="n">do</span> <span class="k">with</span> <span class="n">a</span> <span class="n">link</span> <span class="n">that</span> <span class="n">explains</span> <span class="n">binary</span> <span class="n">representation</span> <span class="n">of</span> <span class="nb">float</span> <span class="o">&amp;</span> <span class="nb">int</span> <span class="k">for</span> <span class="n">those</span> <span class="n">wanting</span> <span class="n">to</span> <span class="n">learn</span> <span class="n">more</span>

<span class="c1">## Development </span>

<span class="n">There</span><span class="s1">&#39;s a bunch of interesting notes in the initial Tweet I sent out: https://twitter.com/ianozsvald/status/1267129298646941696 (thanks to all who replied).</span>

<span class="c1">### Releases</span>

<span class="n">Run</span> <span class="err">`</span><span class="n">pytest</span> <span class="n">dtype_diet</span><span class="o">.</span><span class="n">py</span><span class="err">`</span> <span class="p">(</span><span class="n">better</span> <span class="n">yet</span> <span class="o">-</span> <span class="n">add</span> <span class="n">more</span> <span class="n">tests</span><span class="o">!)</span>. Push to github.

<span class="c1">### Contributors</span>

<span class="o">*</span> <span class="n">Antony</span> <span class="n">Milbourne</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">amilbourne</span>
<span class="o">*</span> <span class="n">Mani</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">neomatrix369</span>

<span class="c1">### Setup</span>

<span class="err">```</span>
<span class="err">$</span> <span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">dtype_diet</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.8</span> <span class="n">pandas</span> <span class="n">jupyter</span> <span class="n">pyarrow</span> <span class="n">pytest</span>
<span class="err">$</span> <span class="n">conda</span> <span class="n">activate</span> <span class="n">dtype_diet</span>
<span class="err">```</span>

<span class="c1"># Contributing</span>
<span class="n">The</span> <span class="n">repository</span> <span class="ow">is</span> <span class="n">developed</span> <span class="k">with</span> <span class="err">`</span><span class="n">nbdev</span><span class="err">`</span><span class="p">,</span> <span class="n">a</span> <span class="n">system</span> <span class="k">for</span> <span class="n">developing</span> <span class="n">library</span> <span class="k">with</span> <span class="n">notebook</span><span class="o">.</span>

<span class="n">Make</span> <span class="n">sure</span> <span class="n">you</span> <span class="n">run</span> <span class="n">this</span> <span class="k">if</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">contribute</span> <span class="n">to</span> <span class="n">the</span> <span class="n">library</span><span class="o">.</span> <span class="n">For</span> <span class="n">details</span><span class="p">,</span> <span class="n">please</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">nbdev</span> <span class="n">documentation</span> <span class="p">(</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">fastai</span><span class="o">/</span><span class="n">nbdev</span><span class="p">)</span>
<span class="err">```</span>
<span class="n">nbdev_install_git_hooks</span>
<span class="err">```</span>

<span class="n">Some</span> <span class="n">other</span> <span class="n">useful</span> <span class="n">commands</span>
<span class="err">```</span>
<span class="n">nbdev_build_docs</span>
<span class="n">nbdev_test_nbs</span>
<span class="err">```</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

